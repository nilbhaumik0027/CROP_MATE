{% extends "base.html" %}

{% block content %}
<div class="advisory-section">
  <h2>ğŸ“ Weather Forecast</h2>
  <button onclick="getWeather()">ğŸ”„ Refresh</button>

  <div id="weather-container" style="margin-top: 20px;">
    <p>ğŸ“¡ Fetching weather...</p>
  </div>
</div>

<script>
async function getWeather() {
  const container = document.getElementById("weather-container");
  container.innerHTML = "ğŸ“¡ Fetching weather...";

  try {
    const pos = await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(resolve, reject);
    });

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const res = await fetch(`/get_weather?lat=${lat}&lon=${lon}`);
    const data = await res.json();

    if (data.error) {
      container.innerHTML = `<p style="color: red;">âŒ ${data.error}</p>`;
      return;
    }

    container.innerHTML = `
      <h3>ğŸ“ ${data.city}</h3>
      <p><strong>${data.description}</strong></p>
      <p>ğŸŒ¡ï¸ Temperature: ${data.temp}Â°C</p>
      <p>ğŸŒ… Sunrise: ${data.sunrise}</p>
      <p>ğŸŒ‡ Sunset: ${data.sunset}</p>
      <p>ğŸ“… Date: ${data.date}</p>
    `;
  } catch (err) {
    container.innerHTML = `<p style="color: red;">âš ï¸ Could not fetch location or weather</p>`;
  }
}

// Auto load on page open
window.onload = getWeather;
</script>
{% endblock %}
